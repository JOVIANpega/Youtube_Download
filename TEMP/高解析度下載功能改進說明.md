# 高解析度下載功能改進說明

## 問題描述
原先的下載器在下載高解析度影片（如1080P）時，會遇到以下問題：
1. 即使影片有1080P解析度，下載器只會下載低解析度版本
2. 當嘗試下載高解析度時，可能會出現合併視頻和音頻流失敗的情況
3. 合併失敗時，已下載的檔案會被丟棄

## 改進方案

### 1. 解析度選擇優化
- 添加「最高品質」選項作為預設選擇
- 添加標準解析度選項（1080P、720P、480P、360P）
- 顯示影片實際可用的所有解析度
- 根據選擇的解析度動態設置下載格式

### 2. 格式選擇邏輯改進
- 使用 `'best'` 格式作為單一格式下載，避免合併問題
- 根據解析度選擇適當的格式限制，例如 `'best[height<=1080]/best'`
- 提供更詳細的日誌輸出，顯示所選解析度和使用的格式

### 3. 多層次備用下載策略
- 第一層：嘗試使用單一高解析度格式下載（1080P或720P）
- 第二層：如果高解析度格式失敗，嘗試使用標準360p格式（格式18）
- 在每一層都會檢查是否成功下載檔案

### 4. 合併失敗處理改進
- 檢測特定的合併錯誤（"Postprocessing" 和 "Could not write header"）
- 當合併失敗時，保留已下載的檔案（通常選擇最大的檔案）
- 顯示清晰的錯誤訊息和處理過程

## 使用方法
1. 輸入視頻URL
2. 點擊「獲取資訊」按鈕
3. 選擇您想要的解析度（例如「最高品質」或「1080P (Full HD)」）
4. 點擊「開始下載」按鈕

## 技術實現
主要修改了以下文件和方法：
- `src/ui/main_window_pyside.py`
  - `DownloadThread.run()`: 改進下載邏輯和錯誤處理
  - `fetch_video_info()`: 改進解析度選擇選項
  - `start_download()`: 根據選擇的解析度設置適當的格式

## 未來可能的改進
- 添加更多格式選項（如webm、mkv等）
- 提供更多自定義選項（如視頻編碼、音頻質量等）
- 改進FFmpeg合併參數，減少合併失敗的可能性 