# 多平台影片下載器 - 更新日誌

## 版本 1.74 (2025-08-20)

### 🔧 界面與功能改進

#### 下載進度顯示與狀態更新
- **修正**: 確保下載進度條顯示在正確的「下載進度」標籤頁，而非「下載任務」頁
- **優化**: 
  - 下載完成後顯示明確的完成狀態、檔案大小與下載時間
  - 下載中的進度條採用不同顏色標示不同狀態（下載中、暫停、完成、失敗等）
  - 總進度條顯示更詳細的統計資訊（總計、下載中、暫停、失敗、完成等數量）
- **影響**: 用戶可以更清楚地了解各個下載任務的狀態

#### 避免重複下載
- **修正**: 清除已完成下載項目後不再重新顯示原始連結
- **功能**:
  - 記錄已完成下載的URL，避免重複下載
  - 檢測輸入的URL是否已下載完成，若是則提示用戶
- **影響**: 防止用戶意外重複下載相同內容，提高效率

#### 下載速度優化
- **改進**: 減少UI更新頻率，避免頻繁更新影響下載速度
- **優化**:
  - 僅在進度有明顯變化時才更新UI
  - 優化下載線程與UI線程的通訊方式
- **影響**: 提高下載速度，減少系統資源佔用

### 🐛 錯誤修正

#### 標籤頁索引記憶
- **修復**: 解決「恢復標籤頁索引失敗」的問題
- **改進**: 確保程式重啟後能正確恢復用戶上次使用的標籤頁
- **影響**: 提升用戶體驗，保持工作連續性

#### 下載完成通知
- **優化**: 改進下載完成通知，新增更多功能
- **功能**:
  - 增加「開啟檔案」和「開啟資料夾」按鈕
  - 顯示檔案大小和下載完成時間
  - 支援多平台（Windows/macOS/Linux）開啟方式
- **影響**: 方便用戶直接訪問下載的內容

### 🔄 其他改進

- 優化信號與槽連接，確保UI更新的及時性
- 改進錯誤處理機制，提供更明確的錯誤信息
- 記錄更詳細的下載過程日誌，便於診斷問題
- 統一進度顯示風格，保持界面一致性

### 🎯 使用說明

- 切換到「下載進度」標籤頁查看所有下載任務的詳細狀態
- 已完成下載的URL不會再次顯示，避免重複下載
- 下載完成後可以直接從通知中開啟檔案或資料夾

### 🔄 升級說明

1. **更新程式**: 替換為新版本的程式檔案
2. **注意事項**: 此版本主要針對界面和功能改進，不需要修改設定檔
3. **打包 EXE**: 使用 `build.bat` 或 `build_exe.py` 打包新版本

---

**版本**: 1.74  
**日期**: 2025-08-20  
**狀態**: 穩定版本

## 版本 1.73 (2025-08-15)

### ✨ 新功能

#### 1. 下載進度專用分頁
- **新增**: 專用的下載進度分頁，集中管理和監控所有下載任務
- **功能**:
  - 獨立顯示下載任務進度和狀態
  - 全局控制功能（全部暫停/繼續）
  - 清理已完成下載的一鍵操作
- **影響**: 主界面更加整潔，下載任務管理更加集中和直觀

#### 2. 外部下載連結優化
- **改進**: 點擊外部下載按鈕直接開啟外部下載網站，而非原始網站
- **功能**:
  - 從設定檔讀取外部下載連結設定
  - 直接開啟對應的外部下載工具頁面
  - 支援所有平台的專用下載服務
- **影響**: 提高下載失敗時的替代方案效率

#### 3. 貼上下載連結邏輯優化
- **改進**: 不再立即清除輸入框，等待下載成功後才清除
- **功能**:
  - 下載失敗時保留原始URL，方便重試
  - 下載成功時才自動清除輸入欄位
  - 下載失敗時顯示外部下載選項
- **影響**: 更友善的使用者體驗，減少連結丟失的可能性

#### 4. 合併檔案管理功能
- **新增**: 檢測並管理下載後的媒體片段和合併檔案
- **功能**:
  - 自動檢測下載的中間檔案
  - 提示是否僅保留合併後的 MP4 檔案
  - 選項記憶功能，可設置永久偏好
- **影響**: 更有效的存儲空間利用，避免冗餘檔案堆積

### 🔧 技術改進

#### 模組化設計優化
- 新增 `progress_tab.py` 模組，獨立處理下載進度相關功能
- 建立 UI 元件與下載線程間的信號連接
- 改進信號與槽機制，提升介面響應性

#### 用戶介面優化
- 分頁式設計改進，功能區分更明確
- 進度顯示和任務管理獨立化
- 統一的錯誤處理和提示機制

### 🎯 使用說明

#### 下載進度分頁
- 切換到「下載進度」分頁可查看所有下載任務
- 可一次性操作所有下載任務（暫停/繼續/清除已完成）
- 任務狀態和進度一目了然

#### 貼上下載連結
- 貼上連結後開始下載，連結將保留直到下載成功
- 下載失敗時可重新嘗試或使用外部下載選項
- 下載成功後輸入欄位將自動清除

#### 合併檔案管理
- 下載完成時若檢測到多個媒體片段，會詢問是否只保留合併後的檔案
- 可選擇「記住我的選擇」避免每次都被詢問
- 可從設定中修改此偏好

### 🔄 升級說明

1. **備份設定**: 建議備份現有的 `setup.json` 檔案
2. **更新程式**: 替換為新版本的程式檔案
3. **首次運行**: 注意觀察新增的「下載進度」分頁和其他新功能
4. **打包 EXE**: 使用 `build.bat` 或 `build_exe.py` 打包新版本

---

**版本**: 1.73
**日期**: 2025-08-15
**狀態**: 穩定版本

## 版本 1.72 (2025-07-19)

### 🐛 錯誤修正

#### 1. 下載錯誤修正
- **問題**: 下載時出現 `'DownloadTab' object has no attribute 'add_download_monitor'` 錯誤
- **修正**: 移除了未定義的 `add_download_monitor` 方法調用
- **影響**: 下載功能現在可以正常工作，不會再出現此錯誤

#### 2. 設定保存問題修正
- **問題**: 用戶的設定（檔案路徑、前綴名稱、視窗大小等）無法正確保存
- **修正**: 
  - 統一使用 `get_settings_path()` 確保路徑一致性
  - 修正 `save_settings()` 方法中的路徑問題
  - 添加即時保存功能到所有用戶操作
  - 修正 `on_prefix_changed()` 和 `browse_path()` 方法的路徑問題
- **影響**: 所有用戶設定現在都能正確保存和載入

#### 3. 外部下載工具 URL 修正
- **問題**: 外部下載工具打開錯誤的網址（例如 Facebook 點開竟然是官方網站）
- **修正**: 
  - 添加 URL 編碼處理 (`urllib.parse.quote`)
  - 修正 URL 獲取邏輯，優先從 `download_items` 獲取
  - 修正 `open_external_download_site` 方法中的 URL 構建
  - 確保所有平台的外部下載工具都能正確打開對應的下載網站
- **影響**: 外部下載工具現在能正確打開對應的下載網站，而不是官方網站

#### 4. 支援平台點擊功能
- **新增**: 支援平台文字現在可以點擊
- **功能**: 
  - 點擊平台名稱可直接訪問對應網站
  - 添加了所有主要平台的連結
  - 包含 YouTube, TikTok, Facebook, Instagram, Bilibili, X(Twitter) 等
- **影響**: 提升用戶體驗，方便快速訪問各平台

### 🔧 技術改進

#### 設定系統優化
- 統一設定檔案路徑管理
- 添加設定驗證和錯誤處理
- 即時保存用戶操作
- 改進設定載入邏輯

#### 錯誤處理改進
- 添加更詳細的錯誤訊息
- 改進異常處理機制
- 添加日誌記錄功能

#### 用戶介面改進
- 支援平台文字可點擊
- 改進錯誤對話框顯示
- 優化外部下載工具按鈕

### 📦 打包改進

#### EXE 打包
- 創建自動化打包腳本 (`build_exe.py`, `build.bat`)
- 支援單一檔案打包
- 自動複製設定檔案
- 清理舊的打包檔案

### 🎯 使用說明

#### 設定保存
- 所有設定會自動保存到 `setup.json`
- 包括：下載路徑、前綴名稱、視窗大小、字體大小等
- 程式重啟後會自動載入上次的設定

#### 外部下載工具
- 當 yt-dlp 無法下載時，會顯示外部下載工具選項
- 點擊對應按鈕會打開專門的下載網站
- URL 會自動編碼，確保正確傳遞

#### 支援平台
- 點擊支援平台列表中的平台名稱可直接訪問對應網站
- 所有連結都會在新視窗中打開

### 🔄 升級說明

1. **備份設定**: 建議備份現有的 `setup.json` 檔案
2. **更新程式**: 替換為新版本的程式檔案
3. **測試功能**: 確認所有功能正常運作
4. **打包 EXE**: 使用 `build.bat` 或 `build_exe.py` 打包新版本

### 📝 注意事項

- 確保已安裝所需的 Python 套件 (PySide6, yt-dlp 等)
- 首次運行會自動創建預設設定檔
- 外部下載工具需要網路連線
- 某些平台可能需要登入或 cookies 才能下載

---

**版本**: 1.72  
**日期**: 2025-07-19  
**狀態**: 穩定版本 